<!DOCTYPE html>
<html>
<head>
    <title>data viz</title>
    <script type="text/javascript" src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-alpha1/jquery.min.js'></script>
    <script type="text/javascript" src='https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js'></script>
    <script type="text/javascript" src='paper/dist/paper-full.js'></script>
</head>
<body>
<div id="text">
    red: Tweets with Miley, blue: Tweets with Nicki, green: Tweets with Taylor
</div>
<canvas height="700" width="1200" id="content"></canvas>

<script type="text/paperscript" canvas="content">

    var Mtext = new Path.Circle({
            center: view.center,
            radius: 2,
            fillColor: 'red'
            });

    var Ntext = new Path.Circle({
            center: new Point(100, 100),
            radius: 2,
            fillColor: 'blue'
            });

    var Ttext = new Path.Circle({
            center: new Point(100, 500),
            radius: 2,
            fillColor: 'green'
            });

    var dateText = new PointText({
        point: view.center,
        justification: 'center',
        fontSize: 30,
        fillColor: 'black'});

        var sheetData;
        var done = 0;
        var index = 0;
        var destinationA = Point.random() * view.size;
        var destinationB = Point.random() * view.size;
        var destinationC = Point.random() * view.size;

    $(document).ready(function() { 
        $.ajax({
            type: 'GET',
            url: 'Miley.Nicki.Taylor.csv',
            dataType: 'text',
            success: function(data) {
                sheetData = $.csv.toObjects(data);
                done = 1;
            },

            error: function(err) {
                console.log(err);
            }
        });
    });

    function onFrame(event) {
        var vectorA = destinationA - Mtext.position;
        var vectorB = destinationB - Ntext.position;
        var vectorC = destinationC - Ttext.position;

        Mtext.position += vectorA / 30;
        Ntext.position += vectorB / 30;
        Ttext.position += vectorC / 30;

        if (vectorA.length < 7) {
        destinationA = Point.random() * view.size;
        }

        if (vectorB.length < 7) {
        destinationB = Point.random() * view.size;
        }

        if (vectorC.length < 7) {
        destinationC = Point.random() * view.size;
        }



                if (done == 0) {
                    // do nothing
                }

                else if (index >= sheetData.length) {
                    console.log("done");
                }

                else {

                    var currentTweet = sheetData[index];

                    dateText.content = new Date(currentTweet.date);
                    if(currentTweet.tweet.indexOf('Miley') !== -1) {
                        Mtext.scale(1.01);
                    }

                    else if(currentTweet.tweet.indexOf('Nicki') !== -1) {
                        Ntext.scale(1.01);
                    }

                    else if(currentTweet.tweet.indexOf('Taylor') !== -1){
                        Ttext.scale(1.01);
                    }

                    else {
                        // nothing
                    }

                    index++;
                }
        };

</script>
</body>
</html>